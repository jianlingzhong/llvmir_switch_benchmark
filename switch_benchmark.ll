; ModuleID = 'switch_benchmark'
source_filename = "switch_benchmark"

; Function to benchmark the switch instruction
define i64 @benchmark_switch(i64 %input) {
entry:
  switch i64 %input, label %default [
    i64 0, label %case0
    i64 1, label %case1
    i64 2, label %case2
    i64 3, label %case3
    i64 4, label %case4
    i64 5, label %case5
    i64 6, label %case6
    i64 7, label %case7
    i64 8, label %case8
    i64 9, label %case9
    i64 10, label %case10
    i64 11, label %case11
    i64 12, label %case12
    i64 13, label %case13
    i64 14, label %case14
    i64 15, label %case15
    i64 16, label %case16
    i64 17, label %case17
    i64 18, label %case18
    i64 19, label %case19
    i64 20, label %case20
    i64 21, label %case21
    i64 22, label %case22
    i64 23, label %case23
    i64 24, label %case24
    i64 25, label %case25
    i64 26, label %case26
    i64 27, label %case27
    i64 28, label %case28
    i64 29, label %case29
    i64 30, label %case30
    i64 31, label %case31
    i64 32, label %case32
    i64 33, label %case33
    i64 34, label %case34
    i64 35, label %case35
    i64 36, label %case36
    i64 37, label %case37
    i64 38, label %case38
    i64 39, label %case39
    i64 40, label %case40
    i64 41, label %case41
    i64 42, label %case42
    i64 43, label %case43
    i64 44, label %case44
    i64 45, label %case45
    i64 46, label %case46
    i64 47, label %case47
    i64 48, label %case48
    i64 49, label %case49
    i64 50, label %case50
    i64 51, label %case51
    i64 52, label %case52
    i64 53, label %case53
    i64 54, label %case54
    i64 55, label %case55
    i64 56, label %case56
    i64 57, label %case57
    i64 58, label %case58
    i64 59, label %case59
    i64 60, label %case60
    i64 61, label %case61
    i64 62, label %case62
    i64 63, label %case63
    i64 64, label %case64
    i64 65, label %case65
    i64 66, label %case66
    i64 67, label %case67
    i64 68, label %case68
    i64 69, label %case69
    i64 70, label %case70
    i64 71, label %case71
    i64 72, label %case72
    i64 73, label %case73
    i64 74, label %case74
    i64 75, label %case75
    i64 76, label %case76
    i64 77, label %case77
    i64 78, label %case78
    i64 79, label %case79
    i64 80, label %case80
    i64 81, label %case81
    i64 82, label %case82
    i64 83, label %case83
    i64 84, label %case84
    i64 85, label %case85
    i64 86, label %case86
    i64 87, label %case87
    i64 88, label %case88
    i64 89, label %case89
    i64 90, label %case90
    i64 91, label %case91
    i64 92, label %case92
    i64 93, label %case93
    i64 94, label %case94
    i64 95, label %case95
    i64 96, label %case96
    i64 97, label %case97
    i64 98, label %case98
    i64 99, label %case99
  ]

case0:
  ret i64 100

case1:
  ret i64 101

case2:
  ret i64 102

case3:
  ret i64 103

case4:
  ret i64 104

case5:
  ret i64 105

case6:
  ret i64 106

case7:
  ret i64 107

case8:
  ret i64 108

case9:
  ret i64 109

case10:
  ret i64 110

case11:
  ret i64 111

case12:
  ret i64 112

case13:
  ret i64 113

case14:
  ret i64 114

case15:
  ret i64 115

case16:
  ret i64 116

case17:
  ret i64 117

case18:
  ret i64 118

case19:
  ret i64 119

case20:
  ret i64 120

case21:
  ret i64 121

case22:
  ret i64 122

case23:
  ret i64 123

case24:
  ret i64 124

case25:
  ret i64 125

case26:
  ret i64 126

case27:
  ret i64 127

case28:
  ret i64 128

case29:
  ret i64 129

case30:
  ret i64 130

case31:
  ret i64 131

case32:
  ret i64 132

case33:
  ret i64 133

case34:
  ret i64 134

case35:
  ret i64 135

case36:
  ret i64 136

case37:
  ret i64 137

case38:
  ret i64 138

case39:
  ret i64 139

case40:
  ret i64 140

case41:
  ret i64 141

case42:
  ret i64 142

case43:
  ret i64 143

case44:
  ret i64 144

case45:
  ret i64 145

case46:
  ret i64 146

case47:
  ret i64 147

case48:
  ret i64 148

case49:
  ret i64 149

case50:
  ret i64 150

case51:
  ret i64 151

case52:
  ret i64 152

case53:
  ret i64 153

case54:
  ret i64 154

case55:
  ret i64 155

case56:
  ret i64 156

case57:
  ret i64 157

case58:
  ret i64 158

case59:
  ret i64 159

case60:
  ret i64 160

case61:
  ret i64 161

case62:
  ret i64 162

case63:
  ret i64 163

case64:
  ret i64 164

case65:
  ret i64 165

case66:
  ret i64 166

case67:
  ret i64 167

case68:
  ret i64 168

case69:
  ret i64 169

case70:
  ret i64 170

case71:
  ret i64 171

case72:
  ret i64 172

case73:
  ret i64 173

case74:
  ret i64 174

case75:
  ret i64 175

case76:
  ret i64 176

case77:
  ret i64 177

case78:
  ret i64 178

case79:
  ret i64 179

case80:
  ret i64 180

case81:
  ret i64 181

case82:
  ret i64 182

case83:
  ret i64 183

case84:
  ret i64 184

case85:
  ret i64 185

case86:
  ret i64 186

case87:
  ret i64 187

case88:
  ret i64 188

case89:
  ret i64 189

case90:
  ret i64 190

case91:
  ret i64 191

case92:
  ret i64 192

case93:
  ret i64 193

case94:
  ret i64 194

case95:
  ret i64 195

case96:
  ret i64 196

case97:
  ret i64 197

case98:
  ret i64 198

case99:
  ret i64 199

default:
  ret i64 0
}

declare i64 @atoi(i8*)
; declare i32 @printf(i8*, ...)
; @.str = private unnamed_addr constant [18 x i8] c"Command arg: %ld\0A\00", align 1

; Main function
define i64 @main(i32 %argc, i8** %argv) {
entry:
  ; Allocate space for loop_counter
  %loop_counter = alloca i64, align 8

  ; Check if there is a command-line argument
  %has_args = icmp sgt i32 %argc, 1
  br i1 %has_args, label %process_arg, label %default_case

process_arg:
  ; Get the second command-line argument
  %arg_ptr = getelementptr i8*, i8** %argv, i32 1
  %arg = load i8*, i8** %arg_ptr

  ; Convert the argument from string to integer
  %int_val = call i64 @atoi(i8* %arg)
  br label %call_benchmark

default_case:
  ; Default value if no argument is provided
  %int_val_default = add i64 0, 0
  br label %call_benchmark

call_benchmark:
  ; Select the value to use for @benchmark_time
  %int_val_selected = phi i64 [%int_val, %process_arg], [%int_val_default, %default_case]

  ; %format_ptr = getelementptr inbounds [21 x i8], [21 x i8]* @.str, i64 0, i64 0
  ; call i32 (i8*, ...) @printf(i8* %format_ptr, i64 %int_val_selected)

  ; Call @benchmark_time
  call void @benchmark_time(i64 %int_val_selected, i64* %loop_counter)

  ; Return 0
  ret i64 0
}

; Helper function to benchmark a single case
define void @benchmark_time(i64 %input, i64* %loop_counter_ptr) {
entry:
  ; Initialize loop counter
  store i64 0, i64* %loop_counter_ptr
  br label %loop_start

loop_start:
  ; Load loop counter
  %counter_val = load i64, i64* %loop_counter_ptr

  ; Perform the benchmarking
  call i64 @benchmark_switch(i64 %input)

  ; Increment loop counter
  %new_counter_val = add i64 %counter_val, 1
  store i64 %new_counter_val, i64* %loop_counter_ptr

  ; Check loop condition
  %loop_cond = icmp slt i64 %new_counter_val, 3000000000
  br i1 %loop_cond, label %loop_start, label %loop_end

loop_end:
  ret void
}
